function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("qtype_formulas/editform",["exports","core/notification","core/pending","core/ajax","qtype_formulas/instantiation"],(function(_exports,Notification,_pending,_ajax,Instantiation){var obj;function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=_exports.default=void 0,Notification=_interopRequireWildcard(Notification),_pending=(obj=_pending)&&obj.__esModule?obj:{default:obj},Instantiation=_interopRequireWildcard(Instantiation);var defaultCorrectness="",numberOfParts=0,init=function(defCorrectness){defaultCorrectness=defCorrectness,numberOfParts=document.querySelectorAll("fieldset[id^=id_answerhdr_]").length,Instantiation.init(numberOfParts);for(var i=0;i<numberOfParts;i++){var textfield=document.getElementById("id_correctness_".concat(i));0===i&&textfield.form.addEventListener("submit",reenableCriterionTextfields),textfield.addEventListener("input",blockModeSwitcherIfNeeded.bind(null,i));var checkbox=document.getElementById("id_correctness_simple_mode_".concat(i));checkbox.addEventListener("click",handleGradingCriterionModeSwitcher.bind(null,i)),textfield.dispatchEvent(new Event("input")),checkbox.disabled||textfield.classList.contains("is-invalid")||(checkbox.checked=!0,checkbox.dispatchEvent(new Event("click")));for(var _i=0,_elements=["type","comp","tol"];_i<_elements.length;_i++){var element=_elements[_i];document.getElementById("id_correctness_simple_".concat(element,"_").concat(i)).addEventListener("change",handleSimpleCriterionChanges.bind(null,i))}document.getElementById("id_correctness_simple_tol_".concat(i)).addEventListener("change",normalizeTolerance)}for(var variableFields=[{field:"random",handler:validateRandomvars},{field:"global",handler:validateGlobalvars}],_i2=0;_i2<numberOfParts;_i2++)variableFields.push({field:"1_".concat(_i2),handler:validateLocalvars.bind(null,_i2)});for(var _i3=0,_variableFields=variableFields;_i3<_variableFields.length;_i3++){var field=_variableFields[_i3];document.getElementById("id_vars".concat(field.field)).addEventListener("blur",field.handler)}document.getElementById("id_instantiatebtn").addEventListener("click",Instantiation.instantiate)};_exports.init=init;var _ref,_ref2,_ref3,validateGlobalvars=(_ref=_asyncToGenerator(regeneratorRuntime.mark((function _callee(evt){var pendingPromise,validationResult;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(""!==evt.target.value){_context.next=3;break}return showOrClearValidationError(evt.target.id,""),_context.abrupt("return");case 3:return pendingPromise=new _pending.default("qtype_formulas/validateglobal"),_context.prev=4,_context.next=7,(0,_ajax.call)([{methodname:"qtype_formulas_check_random_global_vars",args:{randomvars:document.getElementById("id_varsrandom").value,globalvars:evt.target.value}}])[0];case 7:""===(validationResult=_context.sent).source||"global"===validationResult.source?showOrClearValidationError(evt.target.id,validationResult.message):showOrClearValidationError("id_varsrandom",validationResult.message,!1),_context.next=14;break;case 11:_context.prev=11,_context.t0=_context.catch(4),Notification.exception(_context.t0);case 14:pendingPromise.resolve();case 15:case"end":return _context.stop()}}),_callee,null,[[4,11]])}))),function(_x){return _ref.apply(this,arguments)}),validateRandomvars=(_ref2=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(evt){var pendingPromise,validationResult;return regeneratorRuntime.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(""!==evt.target.value){_context2.next=3;break}return showOrClearValidationError(evt.target.id,""),_context2.abrupt("return");case 3:return pendingPromise=new _pending.default("qtype_formulas/validaterandom"),_context2.prev=4,_context2.next=7,(0,_ajax.call)([{methodname:"qtype_formulas_check_random_global_vars",args:{randomvars:evt.target.value}}])[0];case 7:validationResult=_context2.sent,showOrClearValidationError(evt.target.id,validationResult.message),_context2.next=14;break;case 11:_context2.prev=11,_context2.t0=_context2.catch(4),Notification.exception(_context2.t0);case 14:pendingPromise.resolve();case 15:case"end":return _context2.stop()}}),_callee2,null,[[4,11]])}))),function(_x2){return _ref2.apply(this,arguments)}),validateLocalvars=(_ref3=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(part){var fieldList,target,pendingPromise,validationResult;return regeneratorRuntime.wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(fieldList={random:"id_varsrandom",global:"id_varsglobal",local:"id_vars1_".concat(part)},""!==(target=document.getElementById(fieldList.local)).value){_context3.next=5;break}return showOrClearValidationError(target.id,""),_context3.abrupt("return");case 5:return pendingPromise=new _pending.default("qtype_formulas/validatelocal"),_context3.prev=6,_context3.next=9,(0,_ajax.call)([{methodname:"qtype_formulas_check_local_vars",args:{randomvars:document.getElementById(fieldList.random).value,globalvars:document.getElementById(fieldList.global).value,localvars:target.value}}])[0];case 9:""===(validationResult=_context3.sent).source&&(validationResult.source="local"),showOrClearValidationError(fieldList[validationResult.source],validationResult.message,"local"===validationResult.source),_context3.next=17;break;case 14:_context3.prev=14,_context3.t0=_context3.catch(6),Notification.exception(_context3.t0);case 17:pendingPromise.resolve();case 18:case"end":return _context3.stop()}}),_callee3,null,[[6,14]])}))),function(_x3){return _ref3.apply(this,arguments)}),showOrClearValidationError=function(fieldID,message){var sameField=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],field=document.getElementById(fieldID),annotation=document.getElementById(fieldID.replace(/^id_(.*)$/,"id_error_$1")),alreadyWithError=""!==annotation.innerText.trim();if(""===message)return annotation.innerText="",void field.classList.remove("is-invalid");annotation.innerText=message,field.classList.add("is-invalid"),alreadyWithError&&sameField||field.focus()},reenableCriterionTextfields=function(){for(var i=0;i<numberOfParts;i++)document.getElementById("id_correctness_".concat(i)).disabled=!1},handleSimpleCriterionChanges=function(partNumber){document.getElementById("id_correctness_".concat(partNumber)).value=convertSimpleCriterionToText(partNumber)},normalizeTolerance=function(event){var field=event.target,tolerance=parseFloat(field.value);!isNaN(tolerance)&&isFinite(tolerance)||(tolerance=0),field.value=tolerance},handleGradingCriterionModeSwitcher=function(partNumber){var checkbox=document.getElementById("id_correctness_simple_mode_".concat(partNumber)),criterionTextfield=document.getElementById("id_correctness_".concat(partNumber));if(checkbox.checked){""==criterionTextfield.value.trim()&&(criterionTextfield.value=defaultCorrectness);var simpleCriterion=convertTextCriterionToSimple(partNumber);document.getElementById("id_correctness_simple_type_".concat(partNumber)).value=simpleCriterion.type,document.getElementById("id_correctness_simple_comp_".concat(partNumber)).value=simpleCriterion.comparison,document.getElementById("id_correctness_simple_tol_".concat(partNumber)).value=simpleCriterion.tolerance}else criterionTextfield.value=convertSimpleCriterionToText(partNumber)},convertSimpleCriterionToText=function(partNumber){var typeElement=document.getElementById("id_correctness_simple_type_".concat(partNumber)),comparisonElement=document.getElementById("id_correctness_simple_comp_".concat(partNumber)),toleranceElement=document.getElementById("id_correctness_simple_tol_".concat(partNumber));return["_relerr","_err"][typeElement.value]+" "+comparisonElement.options[comparisonElement.value].innerText+" "+parseFloat(toleranceElement.value)},convertTextCriterionToSimple=function(partNumber){var criterionParts=document.getElementById("id_correctness_".concat(partNumber)).value.split(/\s*(==|<)\s*/);if(3!=criterionParts.length||!criterionParts[0].match(/^\s*_(rel)?err\s*$/))throw new TypeError("The given grading criterion cannot be shown in simple mode.");return{type:["_relerr","_err"].indexOf(criterionParts[0]),comparison:["==","<"].indexOf(criterionParts[1]),tolerance:parseFloat(criterionParts[2])}},blockModeSwitcherIfNeeded=function(partNumber){var criterion=document.getElementById("id_correctness_".concat(partNumber)).value.trim(),modeCheckbox=document.getElementById("id_correctness_simple_mode_".concat(partNumber));if(""!=criterion){var criterionParts=criterion.split(/\s*(==|<)\s*/);if(3==criterionParts.length)if(criterionParts[0].match(/^\s*_(rel)?err\s*$/))if(criterionParts[1].match(/\s*(==|<)\s*$/)){var tolerance=parseFloat(criterionParts[2]);isNaN(tolerance)||!isFinite(tolerance)||criterionParts[2].match(/[^-+0-9.e]/)?modeCheckbox.disabled=!0:modeCheckbox.disabled=!1}else modeCheckbox.disabled=!0;else modeCheckbox.disabled=!0;else modeCheckbox.disabled=!0}else modeCheckbox.disabled=!1},_default={init:init};return _exports.default=_default,_exports.default}));

//# sourceMappingURL=editform.min.js.map