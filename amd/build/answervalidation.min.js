define("qtype_formulas/answervalidation",["exports","core/notification","core/pending","core/ajax","qtype_formulas/latexify","core_filters/events"],(function(_exports,Notification,_pending,_ajax,_latexify,_events){var obj;function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=_exports.default=void 0,Notification=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}
/**
   * On-the-fly validation for student input to Formulas questions.
   *
   * @module     qtype_formulas/answervalidation
   * @copyright  2025 Philipp Imhof
   * @author     Philipp Imhof
   * @license    https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */(Notification),_pending=(obj=_pending)&&obj.__esModule?obj:{default:obj};var timers=[];const init=()=>{void 0===window.MathJax&&forceInitMathJax();let inputs=document.getElementsByTagName("input");for(let input of inputs)"text"===input.type&&input.className.match("formulas_")&&"unit"!=input.dataset.answertype&&(input.addEventListener("input",setDebounceTimer),input.addEventListener("focus",focusReceived),input.addEventListener("blur",focusLost));void 0!==_events.eventTypes.filterContentRenderingComplete&&document.addEventListener(_events.eventTypes.filterContentRenderingComplete,handleRenderingComplete)};_exports.init=init;const focusReceived=evt=>{let field=evt.target;if(""==field.value)return;let div=document.getElementById("qtype_formulas_mathjax_display");null===div||div.dataset.for!=field.id?validateStudentAnswer(field.id):div.style.visibility="visible"},focusLost=()=>{hideMathJax()},forceInitMathJax=()=>{void 0===window.MathJax?((0,_events.notifyFilterContentUpdated)(document.querySelector("body")),setTimeout(forceInitMathJax,200)):window.MathJax.Hub.Register.MessageHook("New Math",handleRenderingComplete)},handleRenderingComplete=evt=>{let mathjaxSpan=null;if(Array.isArray(evt)){let id=evt[1];mathjaxSpan=document.querySelector("span#".concat(id,"-Frame"))}else if(evt instanceof CustomEvent)for(let element of evt.detail.nodes)if("qtype_formulas_mathjax_display"===element.id){mathjaxSpan=document.querySelector("span[id^=MathJax-Element-][id$=Frame]");break}let width=0;null!==mathjaxSpan&&(width=mathjaxSpan.getBoundingClientRect().width),window.console.log(width)},validateStudentAnswer=async id=>{let field=document.getElementById(id),symbol=document.getElementById("warning-".concat(id));if(""===field.value)return void(symbol.style.visibility="hidden");let pendingPromise=new _pending.default("qtype_formulas/validatestudentanswer");try{let validationResult=await(0,_ajax.call)([{methodname:"qtype_formulas_validate_student_answer",args:{answer:field.value,answertype:field.dataset.answertype,withunit:field.dataset.withunit}}])[0];if(symbol.style.visibility=validationResult?"hidden":"visible",validationResult){let texcode=await(0,_latexify.latexify)(field.value);showMathJax(id,texcode)}else hideMathJax()}catch(err){Notification.exception(err)}pendingPromise.resolve()},hideMathJax=()=>{let div=document.getElementById("qtype_formulas_mathjax_display");null!==div&&(div.style.visibility="hidden")},showMathJax=(id,texcode)=>{let field=document.getElementById(id);document.activeElement.id;let div=document.getElementById("qtype_formulas_mathjax_display");null!==div&&div.dataset.for!==id&&(div.dataset.for=id,field.parentNode.insertBefore(div,field.nextSibling)),null===div&&(div=document.createElement("div"),div.id="qtype_formulas_mathjax_display",div.classList.add("filter_mathjaxloader_equation"),div.dataset.for=id),div.style.visibility="visible",div.innerText="\\(\\displaystyle ".concat(texcode," \\)"),(0,_events.notifyFilterContentUpdated)(div.parentNode)},setDebounceTimer=evt=>{"number"==typeof timers[evt.target.id]&&clearTimeout(timers[evt.target.id]),timers[evt.target.id]=setTimeout(validateStudentAnswer,200,evt.target.id)};var _default={init:init};return _exports.default=_default,_exports.default}));

//# sourceMappingURL=answervalidation.min.js.map