define("qtype_formulas/answervalidation",["exports","core/notification","core/pending","core/ajax","core_filters/events"],(function(_exports,Notification,_pending,_ajax,_events){var obj;function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=_exports.default=void 0,Notification=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}
/**
   * On-the-fly validation for student input to Formulas questions.
   *
   * @module     qtype_formulas/answervalidation
   * @copyright  2025 Philipp Imhof
   * @author     Philipp Imhof
   * @license    https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */(Notification),_pending=(obj=_pending)&&obj.__esModule?obj:{default:obj};var timer=null;const init=()=>{void 0===window.MathJax&&forceInitMathJax();let inputs=document.querySelectorAll("input[type='text'][class*='formulas_'],input[type='text'][id*='_postunit_']");for(let input of inputs)input.addEventListener("input",setDebounceTimer),input.addEventListener("focus",focusReceived),input.addEventListener("blur",hideMathJax);void 0!==_events.eventTypes.filterContentRenderingComplete?document.addEventListener(_events.eventTypes.filterContentRenderingComplete,handleRenderingComplete):addLegacyMathJaxListener()};_exports.init=init;const focusReceived=evt=>{const field=evt.target;if(""==field.value.trim())return;const div=document.getElementById("qtype_formulas_mathjax_display");field.classList.contains("is-invalid")||null===div||div.dataset.for!=field.id?validateStudentAnswer(field.id):div.style.visibility="visible"},forceInitMathJax=()=>{void 0===window.MathJax&&((0,_events.notifyFilterContentUpdated)(document.querySelector("body")),setTimeout(forceInitMathJax,200))},addLegacyMathJaxListener=()=>{void 0===window.MathJax?setTimeout(addLegacyMathJaxListener,200):window.MathJax.Hub.Register.MessageHook("New Math",handleRenderingComplete)},handleRenderingComplete=evt=>{let mathjaxSpan=null;if(Array.isArray(evt)){let id=evt[1];mathjaxSpan=document.querySelector("span#".concat(id,"-Frame"))}else if(evt instanceof CustomEvent)for(let element of evt.detail.nodes)if("qtype_formulas_mathjax_display"===element.id){mathjaxSpan=document.querySelector("span[id^='MathJax-Element-'][id$='Frame']");break}let width=0;null!==mathjaxSpan&&(width=mathjaxSpan.getBoundingClientRect().width);let div=document.getElementById("qtype_formulas_mathjax_display");if(null!==div){let style=window.getComputedStyle(div);width+=3*parseInt(style.padding),width=Math.min(width,div.parentNode.getBoundingClientRect().width),div.style.width=width+"px"}},validateStudentAnswer=async id=>{let field=document.getElementById(id);if(""===field.value.trim())return field.classList.remove("is-invalid"),void hideMathJax();let pendingPromise=new _pending.default("qtype_formulas/validateanswer");try{let method,args;"unit"===field.dataset.answertype||field.id.includes("_postunit_")?(method="qtype_formulas_validate_unit",args={unit:field.value}):(method="qtype_formulas_validate_student_answer",args={answer:field.value,answertype:field.dataset.answertype,withunit:field.dataset.withunit});let validationResult=await(0,_ajax.call)([{methodname:method,args:args}])[0];"success"===validationResult.status?(field.classList.remove("is-invalid"),showMathJax(id,validationResult.detail)):(field.classList.add("is-invalid"),hideMathJax())}catch(err){Notification.exception(err)}pendingPromise.resolve()},hideMathJax=()=>{let div=document.getElementById("qtype_formulas_mathjax_display");null!==div&&(div.style.visibility="hidden")},showMathJax=(id,texcode)=>{let field=document.getElementById(id);if(document.activeElement.id!==id)return;if(field.value.match(/^([A-Za-z]+|[0-9]*\.?[0-9]*)$/))return void hideMathJax();let div=document.getElementById("qtype_formulas_mathjax_display");null!==div&&div.dataset.for!==id&&(div.remove(),div=null),null===div&&(div=document.createElement("div"),div.id="qtype_formulas_mathjax_display",div.classList.add("filter_mathjaxloader_equation"),div.dataset.for=id,div.style.left=field.offsetLeft+"px",field.parentNode.insertBefore(div,field.nextSibling)),div.innerText="\\(\\displaystyle ".concat(texcode," \\)"),div.style.visibility="visible",(0,_events.notifyFilterContentUpdated)(div.parentNode)},setDebounceTimer=evt=>{"number"==typeof timer&&clearTimeout(timer),timer=setTimeout(validateStudentAnswer,250,evt.target.id)};var _default={init:init};return _exports.default=_default,_exports.default}));

//# sourceMappingURL=answervalidation.min.js.map